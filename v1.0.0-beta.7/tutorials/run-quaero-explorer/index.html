<!DOCTYPE html>

<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><link href="../new-project/" rel="prev"/><link href="../custom-fields/" rel="next"/><link href="../../assets/images/icon.svg" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.3.2" name="generator"/><title>Run the Quaero Explorer - Metanno</title><link href="../../assets/stylesheets/main.30068a00.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.85d0ee34.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="../../override.css" rel="stylesheet"/><link href="../../assets/stylesheets/extra.css" rel="stylesheet"/><link href="../../clickable-code.css" rel="stylesheet"/><link href="../../cards.css" rel="stylesheet"/><link href="../../pret.css" rel="stylesheet"/><link href="../../notebook.css" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr"> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#run-the-quaero-explorer"> Skip to content </a> </div> <div data-md-component="announce"> </div> <div data-md-color-scheme="default" data-md-component="outdated" hidden=""> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="Metanno" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Metanno"> <img alt="logo" src="../../assets/images/icon.svg"/> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> Metanno </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Run the Quaero Explorer </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix=""> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="Metanno" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Metanno"> <img alt="logo" src="../../assets/images/icon.svg"/> </a> Metanno </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../.."> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../installation/"> <span class="md-ellipsis"> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../demos/"> <span class="md-ellipsis"> Demos </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/> <div class="md-nav__link md-nav__container"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Tutorials </span> </a> <label class="md-nav__link" for="__nav_4"> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_4"> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../new-project/"> <span class="md-ellipsis"> Set up a new project </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Run the Quaero Explorer </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> Run the Quaero Explorer </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisites"> Prerequisites </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#run-the-app"> Run the app </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#code-breakdown"> Code breakdown </a> <nav aria-label="Code breakdown" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#1-load-the-data"> 1) Load the data </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#2-make-a-widget-factory"> 2) Make a widget factory </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#3-configure-labels"> 3) Configure labels </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#4-build-the-views-and-define-their-interactions"> 4) Build the views and define their interactions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#5-assemble-everything"> 5) Assemble everything </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#6-render-or-serve"> 6) Render or serve </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#syncing-collaboration-and-saving"> Syncing, collaboration, and saving </a> <nav aria-label="Syncing, collaboration, and saving" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#live-sync-only-no-persistence"> Live sync only (no persistence) </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#live-sync-and-saving-to-a-file"> Live sync and saving to a file </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#what-is-the-saved-format"> What is the saved format? </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../custom-fields/"> <span class="md-ellipsis"> Annotating custom fields </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../multi-collections/"> <span class="md-ellipsis"> Nested and linked collections </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../pre-annotation/"> <span class="md-ellipsis"> Pre-annotate data with EDS-NLP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../components/"> <span class="md-ellipsis"> Building Blocks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../reference/metanno/"> <span class="md-ellipsis"> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../changelog/"> <span class="md-ellipsis"> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisites"> Prerequisites </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#run-the-app"> Run the app </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#code-breakdown"> Code breakdown </a> <nav aria-label="Code breakdown" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#1-load-the-data"> 1) Load the data </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#2-make-a-widget-factory"> 2) Make a widget factory </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#3-configure-labels"> 3) Configure labels </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#4-build-the-views-and-define-their-interactions"> 4) Build the views and define their interactions </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#5-assemble-everything"> 5) Assemble everything </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#6-render-or-serve"> 6) Render or serve </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#syncing-collaboration-and-saving"> Syncing, collaboration, and saving </a> <nav aria-label="Syncing, collaboration, and saving" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#live-sync-only-no-persistence"> Live sync only (no persistence) </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#live-sync-and-saving-to-a-file"> Live sync and saving to a file </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#what-is-the-saved-format"> What is the saved format? </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <div style="clear: both;"> <a class="md-button md-button--primary" download="run-quaero-explorer.ipynb" href="https://cdn.jsdelivr.net/gh/percevalw/metanno@711011a1388157b913b9d77dd081072f46b149b8/docs/tutorials/run-quaero-explorer.ipynb" style="float: right; margin: 5px 0 0px;
            background-color: var(--md-primary-fg-color);
            border-color: var(--md-primary-fg-color);
            border-radius: 4px;
            display: inline-flex; align-items: center; gap: 6px; padding: 0 0.5em;"> <svg fill="none" height="20px" viewbox="0 0 24 24" width="20px" xmlns="http://www.w3.org/2000/svg"> <path d="M3 15C3 17.8284 3 19.2426 3.87868 20.1213C4.75736 21 6.17157 21 9 21H15C17.8284 21 19.2426 21 20.1213 20.1213C21 19.2426 21 17.8284 21 15" stroke="var(--md-primary-bg-color)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path> <path d="M12 3V16M12 16L16 11.625M12 16L8 11.625" stroke="var(--md-primary-bg-color)" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path> </svg> Download notebook </a> </div> <script>window.PRET_PICKLE_FILE = '../../assets/bundle.474fc7da6804f17f8eb9.pkl';window.PRET_REMOTE_IMPORTS = ['pret-markdown', 'metanno', 'pret-joy', 'react-simple-dock'];</script><h1 id="run-the-quaero-explorer">Run the Quaero Explorer</h1> <p>Run the <a href="../../demos/quaero-data_widget_factory">Quaero Explorer demo app</a> and discover Metanno’s collaborative workflow: real‑time syncing, multi‑panel editing, and simple persistence.</p> <h2 id="prerequisites">Prerequisites</h2> <p>Reuse the same environment you prepared in the <strong><a href="../new-project/">New project tutorial</a></strong>. You should already have a working Python environment with Pret, Metanno, and EDS‑NLP installed.</p> <p>The script downloads the <a href="https://quaerofrenchmed.limsi.fr/"><strong>Quaero FrenchMed</strong></a> dataset on first run, so an Internet access is required.</p> <p>Create a new file named <code>quaero.py</code> in your project and copy the contents from the official example <a href="https://github.com/percevalw/metanno/blob/main/examples/quaero.py">https://github.com/percevalw/metanno/blob/main/examples/quaero.py</a>.</p> <h2 id="run-the-app">Run the app</h2> <p>From a terminal. The server will start at <strong><a href="http://localhost:5000">http://localhost:5000</a></strong>.</p> <div class="highlight" data-md-color-scheme="slate"><pre><span></span><code>python<span class="w"> </span>quaero.py<span class="w"> </span>--port<span class="w"> </span><span class="m">5000</span>
</code></pre></div> <p>Or in JupyterLab, run the following cell:</p> <div class="no-exec highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">quaero</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>

<span class="n">view</span><span class="p">,</span> <span class="n">handles</span> <span class="o">=</span> <span class="n">app</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">view</span>
</code></pre></div> <h2 id="code-breakdown">Code breakdown</h2> <p>Below, we break down the script.</p> <h4 id="1-load-the-data">1) Load the data</h4> <p>We first fetch and extracts the dataset if it isn’t already present, and read the BRAT standoff annotations using EDS-NLP.</p> <p>We then build a collection of <code>notes</code> containing <code>entities</code>.</p> <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://quaerofrenchmed.limsi.fr/QUAERO_FrenchMed_brat.zip"</span>
<span class="n">DOWNLOAD_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"./downloaded"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">download_quaero</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    If the Quaero dataset is not already downloaded,</span>
<span class="sd">    download the Quaero dataset from the official URL and extract it</span>
<span class="sd">    in the QUAERO_FrenchMed_brat directory.</span>
<span class="sd">    """</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">zipfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZipFile</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DOWNLOAD_DIR</span> <span class="o">/</span> <span class="s2">"QUAERO_FrenchMed"</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quaero dataset already exists in </span><span class="si">{</span><span class="n">DOWNLOAD_DIR</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s1">'QUAERO_FrenchMed'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Downloading Quaero dataset..."</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to download Quaero dataset: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
        <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">temp_file_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Extracting Quaero dataset in </span><span class="si">{</span><span class="n">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">temp_file_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">DOWNLOAD_DIR</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">build_data</span><span class="p">():</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">edsnlp</span>

    <span class="n">download_quaero</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">edsnlp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://aphp.github.io/edsnlp/latest/reference/edsnlp/data/standoff/#edsnlp.data.standoff.read_standoff">read_standoff</a></body></html></span><span class="p">(</span>
        <span class="n">DOWNLOAD_DIR</span> <span class="o">/</span> <span class="s2">"QUAERO_FrenchMed/corpus"</span><span class="p">,</span>
        <span class="n">span_setter</span><span class="o">=</span><span class="s2">"entities"</span><span class="p">,</span>
        <span class="n">notes_as_span_attribute</span><span class="o">=</span><span class="s2">"cui"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">"note_id"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">note_id</span><span class="p">),</span>
                <span class="s2">"note_text"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="s2">"note_kind"</span><span class="p">:</span> <span class="s2">"interesting"</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">"very interesting"</span><span class="p">,</span>
                <span class="s2">"seen"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">"entities"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"id"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"#</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                        <span class="s2">"text"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                        <span class="s2">"begin"</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">start_char</span><span class="p">,</span>
                        <span class="s2">"end"</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">end_char</span><span class="p">,</span>
                        <span class="s2">"label"</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">label_</span><span class="p">,</span>
                        <span class="s2">"concept"</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">cui</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="s2">"entities"</span><span class="p">])</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"notes"</span><span class="p">:</span> <span class="n">notes</span><span class="p">}</span>
</code></pre></div> <h4 id="2-make-a-widget-factory">2) Make a widget factory</h4> <p>Let's use the <code>DataWidgetFactory</code>: it's a helper class that we can use to quickly compose apps to view and annotate views of our data. Under the hood, it orchestrate Metanno components such as <a class="autorefs autorefs-internal" href="../../components/table/#metanno.ui.Table">Table</a>, <a class="autorefs autorefs-internal" href="../../components/annotated-text/#metanno.ui.AnnotatedText">AnnotatedText</a>, form fields to keep views synchronized and automatically infer schema relationships from the data.</p> <p>We'll pass the <code>build_data</code> function (and not it's result), and a path to save the current state of the annotated data. If no serialized store exists already, the factory will run the function. Otherwise, it will load the app state from the store directly: this is why we pass a function.</p> <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pret.hooks</span><span class="w"> </span><span class="kn">import</span> <span class="n">RefType</span><span class="p">,</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/hooks/#pret.hooks.use_ref">use_ref</a></body></html></span>

<span class="kn">from</span><span class="w"> </span><span class="nn">metanno.recipes.data_widget_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory">DataWidgetFactory</a></body></html></span><span class="p">,</span>
    <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.FormWidgetHandle">FormWidgetHandle</a></body></html></span><span class="p">,</span>
    <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.TableWidgetHandle">TableWidgetHandle</a></body></html></span><span class="p">,</span>
    <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.TextWidgetHandle">TextWidgetHandle</a></body></html></span><span class="p">,</span>
    <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.infer_fields">infer_fields</a></body></html></span><span class="p">,</span>
<span class="p">)</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory">DataWidgetFactory</a></body></html></span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">build_data</span><span class="p">,</span>
    <span class="n">sync</span><span class="o">=</span><span class="s2">"quaero_app_state.bin"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">data</span>
</code></pre></div> <h4 id="3-configure-labels">3) Configure labels</h4> <p>We compute a stable list of labels, assign a color for each, and auto‑pick a one‑letter keyboard shortcut per label.</p> <div class="highlight"><pre><span></span><code><span class="n">PALETTE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"rgb(255,200,206)"</span><span class="p">,</span>
    <span class="s2">"rgb(210,236,247)"</span><span class="p">,</span>
    <span class="s2">"rgb(211,242,206)"</span><span class="p">,</span>
    <span class="s2">"rgb(208,245,229)"</span><span class="p">,</span>
    <span class="s2">"rgb(208,210,249)"</span><span class="p">,</span>
    <span class="s2">"rgb(232,205,251)"</span><span class="p">,</span>
    <span class="s2">"rgb(253,203,241)"</span><span class="p">,</span>
    <span class="s2">"rgb(252,221,201)"</span><span class="p">,</span>
    <span class="s2">"rgb(249,243,203)"</span><span class="p">,</span>
    <span class="s2">"rgb(230,246,204)"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">all_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">n</span><span class="p">[</span><span class="s2">"entities"</span><span class="p">]))</span>
<span class="n">shortcuts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="n">labels_config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Labels of the dataset:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_labels</span><span class="p">):</span>
    <span class="n">labels_config</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">PALETTE</span><span class="p">):</span>
        <span class="n">labels_config</span><span class="p">[</span><span class="n">lab</span><span class="p">][</span><span class="s2">"color"</span><span class="p">]</span> <span class="o">=</span> <span class="n">PALETTE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">letter</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lab</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">letter</span><span class="p">:</span>
        <span class="n">shortcuts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
        <span class="n">labels_config</span><span class="p">[</span><span class="n">lab</span><span class="p">][</span><span class="s2">"shortcut"</span><span class="p">]</span> <span class="o">=</span> <span class="n">letter</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">" -"</span><span class="p">,</span> <span class="n">lab</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s2">"-&gt;"</span><span class="p">,</span> <span class="n">labels_config</span><span class="p">[</span><span class="n">lab</span><span class="p">])</span>
</code></pre></div> <div class="code-output highlight"><pre><span></span><code>Labels of the dataset:
 - CHEM  -&gt; {'color': 'rgb(255,200,206)', 'shortcut': 'c'}
 - PROC  -&gt; {'color': 'rgb(210,236,247)', 'shortcut': 'p'}
 - LIVB  -&gt; {'color': 'rgb(211,242,206)', 'shortcut': 'l'}
 - DISO  -&gt; {'color': 'rgb(208,245,229)', 'shortcut': 'd'}
 - PHYS  -&gt; {'color': 'rgb(208,210,249)', 'shortcut': 'h'}
 - ANAT  -&gt; {'color': 'rgb(232,205,251)', 'shortcut': 'a'}
 - OBJC  -&gt; {'color': 'rgb(253,203,241)', 'shortcut': 'o'}
 - GEOG  -&gt; {'color': 'rgb(252,221,201)', 'shortcut': 'g'}
 - PHEN  -&gt; {'color': 'rgb(249,243,203)', 'shortcut': 'e'}
 - DEVI  -&gt; {'color': 'rgb(230,246,204)', 'shortcut': 'v'}
</code></pre></div> <h4 id="4-build-the-views-and-define-their-interactions">4) Build the views and define their interactions</h4> <p>We define the views that will be rendered in the app. Each view is a component that displays a specific part of the data. For each view, we'll also create a "handle" to be able to control the widgets imperatively (e.g. change the filters, scroll to a line) if we want to.</p> <p>View the documents as a table:</p> <div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_note_kind_options</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">"EMEA"</span> <span class="ow">in</span> <span class="n">note</span><span class="p">[</span><span class="s2">"note_id"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">"interesting"</span><span class="p">,</span> <span class="s2">"very interesting"</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

<span class="n">notes_table_handle</span><span class="p">:</span> <span class="n">RefType</span><span class="p">[</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.TableWidgetHandle">TableWidgetHandle</a></body></html></span><span class="p">]</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/hooks/#pret.hooks.use_ref">use_ref</a></body></html></span><span class="p">()</span>
<span class="n">notes_view</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory.create_table_widget">create_table_widget</a></body></html></span><span class="p">(</span>
    <span class="n">store_key</span><span class="o">=</span><span class="s2">"notes"</span><span class="p">,</span>
    <span class="n">primary_key</span><span class="o">=</span><span class="s2">"note_id"</span><span class="p">,</span>
    <span class="c1"># Instead of using infer_fields, we can also define the</span>
    <span class="c1"># fields manually which can actually be simpler</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span>  <span class="c1"># type: ignore</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"note_id"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"note_id"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"filterable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"note_text"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"note_text"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"editable"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"filterable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># noqa: E501</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"note_kind"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"note_kind"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"editable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"options"</span><span class="p">:</span> <span class="n">make_note_kind_options</span><span class="p">,</span> <span class="s2">"filterable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># noqa: E501</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"seen"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"seen"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"boolean"</span><span class="p">,</span> <span class="s2">"editable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"filterable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># noqa: E501</span>
    <span class="p">],</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">"--min-notebook-height"</span><span class="p">:</span> <span class="s2">"300px"</span><span class="p">},</span>
    <span class="n">handle</span><span class="o">=</span><span class="n">notes_table_handle</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>Show the selected note as a form:</p> <div class="highlight"><pre><span></span><code><span class="n">note_form_handle</span><span class="p">:</span> <span class="n">RefType</span><span class="p">[</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.FormWidgetHandle">FormWidgetHandle</a></body></html></span><span class="p">]</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/hooks/#pret.hooks.use_ref">use_ref</a></body></html></span><span class="p">()</span>
<span class="n">note_form_view</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory.create_form_widget">create_form_widget</a></body></html></span><span class="p">(</span>
    <span class="n">store_key</span><span class="o">=</span><span class="s2">"notes"</span><span class="p">,</span>
    <span class="n">primary_key</span><span class="o">=</span><span class="s2">"note_id"</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span>  <span class="c1"># type: ignore</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"note_id"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"note_kind"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"radio"</span><span class="p">,</span> <span class="s2">"editable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"options"</span><span class="p">:</span> <span class="n">make_note_kind_options</span><span class="p">,</span> <span class="s2">"filterable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>  <span class="c1"># noqa: E501</span>
        <span class="p">{</span><span class="s2">"key"</span><span class="p">:</span> <span class="s2">"seen"</span><span class="p">,</span> <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"boolean"</span><span class="p">,</span> <span class="s2">"editable"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">],</span>
    <span class="n">add_navigation_buttons</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">"--min-notebook-height"</span><span class="p">:</span> <span class="s2">"300px"</span><span class="p">,</span> <span class="s2">"margin"</span><span class="p">:</span> <span class="s2">"10px"</span><span class="p">},</span>
    <span class="n">handle</span><span class="o">=</span><span class="n">note_form_handle</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># fmt: on</span>
</code></pre></div> <p>View the entities as a table:</p> <div class="highlight"><pre><span></span><code><span class="n">ents_table_handle</span><span class="p">:</span> <span class="n">RefType</span><span class="p">[</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.TableWidgetHandle">TableWidgetHandle</a></body></html></span><span class="p">]</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/hooks/#pret.hooks.use_ref">use_ref</a></body></html></span><span class="p">()</span>
<span class="n">entities_view</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory.create_table_widget">create_table_widget</a></body></html></span><span class="p">(</span>
    <span class="n">store_key</span><span class="o">=</span><span class="s2">"notes.entities"</span><span class="p">,</span>
    <span class="n">primary_key</span><span class="o">=</span><span class="s2">"id"</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.infer_fields">infer_fields</a></body></html></span><span class="p">(</span>
        <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">n</span><span class="p">[</span><span class="s2">"entities"</span><span class="p">]],</span>
        <span class="n">visible_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"text"</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
        <span class="n">id_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
        <span class="n">editable_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
        <span class="n">categorical_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">"--min-notebook-height"</span><span class="p">:</span> <span class="s2">"300px"</span><span class="p">},</span>
    <span class="n">handle</span><span class="o">=</span><span class="n">ents_table_handle</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>View and edit the note text with highlighted entities. <br/> It returns both the text view and a view for the entity being edited</p> <div class="highlight"><pre><span></span><code><span class="n">note_text_handle</span><span class="p">:</span> <span class="n">RefType</span><span class="p">[</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.TextWidgetHandle">TextWidgetHandle</a></body></html></span><span class="p">]</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/hooks/#pret.hooks.use_ref">use_ref</a></body></html></span><span class="p">()</span>
<span class="n">note_text_view</span><span class="p">,</span> <span class="n">ent_view</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory.create_text_widget">create_text_widget</a></body></html></span><span class="p">(</span>
    <span class="n">store_text_key</span><span class="o">=</span><span class="s2">"notes"</span><span class="p">,</span>
    <span class="c1"># Where to look for spans data in the app data</span>
    <span class="n">store_spans_key</span><span class="o">=</span><span class="s2">"notes.entities"</span><span class="p">,</span>
    <span class="c1"># Fields that will be displayed in the toolbar</span>
    <span class="n">fields</span><span class="o">=</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.infer_fields">infer_fields</a></body></html></span><span class="p">(</span>
        <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">n</span><span class="p">[</span><span class="s2">"entities"</span><span class="p">]],</span>
        <span class="n">visible_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
        <span class="n">editable_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
        <span class="n">categorical_keys</span><span class="o">=</span><span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"concept"</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">text_key</span><span class="o">=</span><span class="s2">"note_text"</span><span class="p">,</span>
    <span class="n">text_primary_key</span><span class="o">=</span><span class="s2">"note_id"</span><span class="p">,</span>
    <span class="n">spans_primary_key</span><span class="o">=</span><span class="s2">"id"</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">labels_config</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">"--min-notebook-height"</span><span class="p">:</span> <span class="s2">"300px"</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div> <p>Finally, let's create a header for the note text panel, to be able to tell quickly which document we are viewing</p> <div class="highlight"><pre><span></span><code><span class="n">note_header</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory.create_selected_field_view">create_selected_field_view</a></body></html></span><span class="p">(</span>
    <span class="n">store_key</span><span class="o">=</span><span class="s2">"notes"</span><span class="p">,</span>
    <span class="n">shown_key</span><span class="o">=</span><span class="s2">"note_id"</span><span class="p">,</span>
    <span class="n">fallback</span><span class="o">=</span><span class="s2">"Note"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <h4 id="5-assemble-everything">5) Assemble everything</h4> <p>Let's put everything in a panel layout (using the <code>pret-simple-dock</code> package). <br/> Panels can be resized, rearranged (drag the tab handles), or hidden by docking into another panel’s tab bar.</p> <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pret.react</span><span class="w"> </span><span class="kn">import</span> <span class="n">div</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pret_joy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Box</span><span class="p">,</span> <span class="n">Divider</span><span class="p">,</span> <span class="n">Stack</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pret_markdown</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pret_simple_dock</span><span class="w"> </span><span class="kn">import</span> <span class="n">Layout</span><span class="p">,</span> <span class="n">Panel</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">(</span>
    <span class="n">Layout</span><span class="p">(</span>
        <span class="n">div</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s2">"A markdown description of the dataset/task"</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s2">"margin"</span><span class="p">:</span> <span class="s2">"10px"</span><span class="p">}),</span>
        <span class="n">Panel</span><span class="p">(</span><span class="n">notes_view</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"Notes"</span><span class="p">),</span>
        <span class="n">Panel</span><span class="p">(</span><span class="n">entities_view</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"Entities"</span><span class="p">),</span>
        <span class="n">Panel</span><span class="p">(</span><span class="n">note_text_view</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"Note Text"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">note_header</span><span class="p">),</span>
        <span class="n">Panel</span><span class="p">(</span><span class="n">Stack</span><span class="p">(</span><span class="n">note_form_view</span><span class="p">,</span> <span class="n">Divider</span><span class="p">(),</span> <span class="n">Box</span><span class="p">(</span><span class="n">ent_view</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="p">{</span><span class="s2">"m"</span><span class="p">:</span> <span class="s2">"10px"</span><span class="p">})),</span> <span class="n">key</span><span class="o">=</span><span class="s2">"Info"</span><span class="p">),</span>
        <span class="c1"># Describe how the panels should be arranged by default</span>
        <span class="n">default_config</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"row"</span><span class="p">,</span>
            <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"column"</span><span class="p">,</span>
                    <span class="s2">"size"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">"tabs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Description"</span><span class="p">],</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">40</span><span class="p">},</span>
                        <span class="p">{</span><span class="s2">"tabs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Notes"</span><span class="p">],</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="p">{</span><span class="s2">"tabs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Note Text"</span><span class="p">],</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">"kind"</span><span class="p">:</span> <span class="s2">"column"</span><span class="p">,</span>
                    <span class="s2">"size"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                    <span class="s2">"children"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">"tabs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Info"</span><span class="p">],</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">65</span><span class="p">},</span>
                        <span class="p">{</span><span class="s2">"tabs"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Entities"</span><span class="p">],</span> <span class="s2">"size"</span><span class="p">:</span> <span class="mi">35</span><span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">},</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="n">collapse_tabs_on_mobile</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">"Note Text"</span><span class="p">,</span>
            <span class="s2">"Description"</span><span class="p">,</span>
            <span class="s2">"Notes"</span><span class="p">,</span>
            <span class="s2">"Note Form"</span><span class="p">,</span>
            <span class="s2">"Entities"</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">),</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">create_connection_status_bar</span><span class="p">(),</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"background"</span><span class="p">:</span> <span class="s2">"var(--joy-palette-background-level2, #f0f0f0)"</span><span class="p">,</span>
        <span class="s2">"width"</span><span class="p">:</span> <span class="s2">"100%"</span><span class="p">,</span>
        <span class="s2">"height"</span><span class="p">:</span> <span class="s2">"100%"</span><span class="p">,</span>
        <span class="s2">"minHeight"</span><span class="p">:</span> <span class="s2">"300px"</span><span class="p">,</span>
        <span class="s2">"--sd-background-color"</span><span class="p">:</span> <span class="s2">"transparent"</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div> <h4 id="6-render-or-serve">6) Render or serve</h4> <p>You can either <strong>serve it</strong> or <strong>display it</strong> in a notebook. Check out the <a href="https://percevalw.github.io/pret/latest/tutorials/from-notebook-to-app">Notebook to App</a> pret tutorial for more information. In the mean time, just display the <code>layout</code> var in a cell if you're in Jupyter, then right click it and click on "⚛️ Open in a new browser tab" to create a dedicated tab to the app, or click "Detach" to put the app in its own JupyterLab panel.</p> <div class="pret-code-snippet"> <div class="render-with-pret highlight"><pre><span></span><code><span class="n">layout</span>
</code></pre></div> <div class="pret-code-snippet-view-container"><div class="pret-code-snippet-view-content" data-pret-chunk-idx="0"></div></div></div> <div class="admonition tip"> <p class="admonition-title">Offline app</p> <p>We defined our app as synced with a server file above when we instantiated the factory : since you are likely seing this in a github pages documentation, there is no server to sync to, or said otherwise, the server is currently unreachable. To avoid having users thinking their changes are saved, disconnected apps automatically rollback any changes made to a synchronized store. <br/> This is the reason why you cannot edit the data of the above app. To "unlock" it in offline mode, comment "sync=..."</p> </div> <p>You can interact programmatically with the app using the handles, for instance to change the currently displayed doc.</p> <div class="highlight"><pre><span></span><code><span class="n">note_text_handle</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">set_doc_idx</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</code></pre></div> <h2 id="syncing-collaboration-and-saving">Syncing, collaboration, and saving</h2> <p>Metanno (via Pret) can sync app state across clients and optionally persist it.</p> <h4 id="live-sync-only-no-persistence">Live sync only (no persistence)</h4> <p>Pass <code>sync=True</code> when creating the app to enable real‑time collaboration <strong>without saving to disk</strong>:</p> <div class="highlight"><pre><span></span><code><span class="n">app</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory">DataWidgetFactory</a></body></html></span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">build_data</span><span class="p">,</span>
    <span class="n">sync</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>Open the same notebook twice or the same app URL in two tabs: edits in one tab are mirrored to the other.</p> <h4 id="live-sync-and-saving-to-a-file">Live sync <strong>and</strong> saving to a file</h4> <p>As shown above, you can provide a file path to append every change to an on‑disk log:</p> <div class="highlight"><pre><span></span><code><span class="n">app</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="../../reference/metanno/recipes/data_widget_factory/#metanno.recipes.data_widget_factory.DataWidgetFactory">DataWidgetFactory</a></body></html></span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">build_data</span><span class="p">,</span>
    <span class="n">sync</span><span class="o">=</span><span class="s2">"quaero_app_state.bin"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div> <p>Changes are now saved on disk, and multiple servers/kernels can collaborate by pointing to the same file.</p> <h4 id="what-is-the-saved-format">What is the saved format?</h4> <p>It’s a compact, binary, append‑only log of user mutations: you cannot read it directly.</p> <p>To inspect it, you can use <a class="autorefs autorefs-external" href="https://percevalw.github.io/pret/main/reference/pret/store/#pret.store.create_store"><code>create_store</code></a> synced with the file and read current state, but the object will receive live updates as the underlying file changes, and you risk mutating it by accident.</p> <p>Prefer using the <a class="autorefs autorefs-external" href="https://percevalw.github.io/pret/main/reference/pret/store/#pret.store.load_store_snapshot"><code>load_store_snapshot</code></a> function to load the current state of the store as a pure Python object without subscribing to updates or risking modifying it:</p> <div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pret.store</span><span class="w"> </span><span class="kn">import</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/store/#pret.store.load_store_snapshot">load_store_snapshot</a></body></html></span>

<span class="n">data</span> <span class="o">=</span> <span class="n"><html><head></head><body><a class="clickable-discrete-link" href="https://percevalw.github.io/pret/main/reference/pret/store/#pret.store.load_store_snapshot">load_store_snapshot</a></body></html></span><span class="p">(</span><span class="s2">"quaero_app_state.bin"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]),</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"notes"</span><span class="p">]))</span>
</code></pre></div> <div class="code-output highlight"><pre><span></span><code>2536 &lt;class 'list'&gt;
</code></pre></div> <p>To <strong>export</strong> to other formats, write a small exporter from your in‑memory data (<code>app.data</code>). We recommend using <a href="https://aphp.github.io/edsnlp/latest/data/"><strong>EDS‑NLP</strong> data connectors</a> since it supports several data formats and schemas.</p> <div class="footnote"><hr/><ol></ol></div> </article> </div> </div> <button class="md-top md-icon" data-md-component="top" hidden="" type="button"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: Set up a new project" class="md-footer__link md-footer__link--prev" href="../new-project/" rel="prev"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> Set up a new project </div> </div> </a> <a aria-label="Next: Annotating custom fields" class="md-footer__link md-footer__link--next" href="../custom-fields/" rel="next"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> Annotating custom fields </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.prune", "navigation.top", "navigation.footer", "content.code.annotate", "content.code.copy", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script> <script src="../../assets/remoteEntry.25eeba79d8b085c51811.js"></script><script src="../../assets/remoteEntry.595a1e499ada6f433fb9.js"></script><script src="../../assets/remoteEntry.6ea022cdc6afae8bc05c.js"></script><script src="../../assets/remoteEntry.ce78bae4d5efb7a2ec21.js"></script><script src="../../assets/bundle.c9655a3a06878ecba9e7.js"></script> </body> </html>